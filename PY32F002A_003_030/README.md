##  Обзор и тестирование семейства контроллеров PY32F002A,F003,F030

### Введение
Данные чипы построены на одном кристалле и имеют все свойства старшей модели PY32F030. Ограничение есть только на возможности назначения функций на существующие порты в корпусе. 
(например управление LED сегментными индикаторами возможно только в корпусах 32pin - а это только PY32F030)<br>

Вся внутренняя переферия
```
LSI - 32.768kHz
LSE - 0-1000kHz  (F030: lqfp32, qfn32, tssop20 pinout1 )
HSI - 4,8,16,22.12,24MHz (есть калибровочные константы)
HSE - 4-32MHz
PLL - x2 (from HSI or HSE)
DMA - 3ch, IWDG, WWDG, SysTick, RTC
Timers (16b): Adv:1, GP:4, LP:1, 
2x USART, 2х SPI, 1x I2C
ADC 12bit (10+2ch) (1Msps), 2x Comp
Max Frequency: 48MHz
1.7 - 5.5 V
Hardware CRC-32 module
Support 4-digit 8-segment common-cathode LED digital tube (F030)
```

Дополнительные сведения по серии из [Factory Config](../boot/py32f0xx/README.md)

### Корпуса


### Ремапинг 
Очень богатый выбор ремапинга функций портов (альтернативные функции)<br>
Индивидуально можно настроить каждый пин.<br>
Шаблон возможных вариантов [REMAP](./ReMapIO/remap_pin_py32f0xx.xlsx) <br>

Учитывая одинаковый кристалл внутри данного семейства имеем всего 30 i/o<br>
и все возможные варианты альтернативных функций<br>
Как пример: приведен расклад<br>  
2x full SPI + 2x USART + 3 i/o - для PY32F002AW15U6 (qfn16 3x3)<br>

### Программаторы (Windows 10)

1. ST-Link V2
```
Keil  - работает без проблем
pyocd - в основном работает (кроме режима стирания при подаче питания) 
```

2. J-Link OB (из BluePill STM32F103)
```
Keil  - работает, только требуется добавить описание контроллеров
        в папку <USER>\AppData\Roaming\SEGGER\JLinkDevices\ 
        распаковать архив  [Puya](./J-Link/Puya.7z)
Py32CubeProgrammer - работает
pyocd  - совсем не работает и при любой команде убивается клон J-Link 
```

3. CMSIS-DAP  (2 варианта  WCH-LinkE и  SLogic Combo)
```
Keil  - работает, только есть ошибка при стирании чипа, 
        но чип стирается, а заливка не проходит
        если разделить стирание - отдельно, 
        заливка (без стирания) - отдельно
        то всё нормально! 
pyocd  - прошивка стирание - работает и даже при подаче питания стрить можно        
openocd - пробовал подключать с WCH-LinkE (чип читал пока только)
          openocd - редакция от Puya !
```

4. UART (ISP)
```
Проверено только в Py32CubeProgrammer
пары выводов для UART (PA2,3; PA9,10; PA14,15)
обязательно Boot0='1' (только tssop20,qfn32,lqfp32)
на PY32F030K28T6 - только получилось на PA14,15
на демоплате embedfire - PA2,PA3 и PA14,15 - работает // (PA9,10 - для опц. LSE и не выведены) 
``` 

// по openocd - попробую позже добавить больше данные

### IDE

1. Keil
    нормально можно работать, учитывая отладчик встроенный<br>
    и поддерживающий разные варианты подключаемых программаторов<br>
    (минус - библиотека DFP 1.2.8 с ошибкой при создании нового проекта<br>
    для F030 добавляется два комплекта стартап файлов для F030 и F031)<br>
2. Eclipse
    при создании проекта статртап файлы не добавляются (может чего не донастроено)<br>
    при настройке вручную - всё работает.   
3. IAR
    В процессе изучения
4. VSCode + PlatformIO
    В процессе изучения

### Интересные тесты

#### Прошивка с ошибкой - как тест сброса контроллера
Случайно сделал прошивку с ошибкой<br>
== Назначение PLL как SYSCLK, когда PLL не запущен<br>
В данном режиме программаторы не видят чип (или видят но не могут ничего сделать)<br>
При использовании данной прошивки как тестовой - получилось 
(pyocd)
= стирание памяти при Reset, но кроме чипа PY32F030EK28U6 (на демоплате embedfire).
= данный чип удалось стереть только при подаче питания и
(Py32CubeProgrammer)
= подключение по UART при Boot0-"1" - чип можно перепрограммировать (ISP)

#### Стирание прошивки (сброс) при использовании служебных выводов (SWC,SWD,NRST)
Исходя из прошивки с ошибкой - проведён тест по использованию "всех" портов<br>
на порты с служебными функциями назначены были вывод меандра (LED)<br>
SWC,SWD,NRST (предварительно NRST переведён в режим GPIO)<br>

После прошивки данный чип недоступен для подключения программаторами<br>
Проведён тест с помощью pyocd стереть чип при подаче питания<br>
== Успешно == (только CMSIS-DAP) //  с настоящим J-Link - тоже должно работать<br> 

Если есть вывод Boot0 и он используется как вход, то<br>
Py32CubeProgrammer - подключение по UART при Boot0-"1" - чип можно перепрограммировать<br>
